<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Team - FantasyIA</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css"/>
    <style>
        .filter-row, .form-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }
        .filter-group, .form-group {
            display: flex;
            flex-direction: column;
        }
        .filter-group label, .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .players-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .players-table th, .players-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .add-player-form, .bulk-import-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .bulk-import-form {
            border: 2px dashed #007bff;
        }
        .alert {
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
    <script>
        function validateFile() {
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to upload.');
                return false;
            }
            
            // Check file size (10MB = 10 * 1024 * 1024 bytes)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size is too large. Please use files under 10MB.');
                return false;
            }
            
            // Check file extension
            const fileName = file.name.toLowerCase();
            if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
                alert('Invalid file format. Please use .xlsx or .xls files only.');
                return false;
            }
            
            // Show loading message
            const submitButton = document.getElementById('import-button');
            submitButton.disabled = true;
            submitButton.textContent = 'Importing...';
            
            return true;
        }
        
        function updateFileName() {
            const fileInput = document.getElementById('file');
            const fileLabel = document.getElementById('file-label');
            
            if (fileInput.files.length > 0) {
                fileLabel.textContent = fileInput.files[0].name;
                fileLabel.style.color = '#007bff';
            } else {
                fileLabel.textContent = 'Select Excel File:';
                fileLabel.style.color = '';
            }
        }
    </script>
</head>
<body>
    <div class="team-container">
        <h1>My Fantasy Baseball Team</h1>
        <p><a th:href="@{/}">‚Üê Back to Home</a></p>

        <!-- Filter Form -->
        <div class="filter-form">
            <h3>Filter Players</h3>
            <form th:action="@{/team}" method="get">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="position">Position:</label>
                        <select id="position" name="position">
                            <option value="">All Positions</option>
                            <option th:value="'C'" th:selected="${selectedPosition == 'C'}">Catcher (C)</option>
                            <option th:value="'1B'" th:selected="${selectedPosition == '1B'}">First Base (1B)</option>
                            <option th:value="'2B'" th:selected="${selectedPosition == '2B'}">Second Base (2B)</option>
                            <option th:value="'3B'" th:selected="${selectedPosition == '3B'}">Third Base (3B)</option>
                            <option th:value="'SS'" th:selected="${selectedPosition == 'SS'}">Shortstop (SS)</option>
                            <option th:value="'OF'" th:selected="${selectedPosition == 'OF'}">Outfield (OF)</option>
                            <option th:value="'DH'" th:selected="${selectedPosition == 'DH'}">Designated Hitter (DH)</option>
                            <option th:value="'SP'" th:selected="${selectedPosition == 'SP'}">Starting Pitcher (SP)</option>
                            <option th:value="'RP'" th:selected="${selectedPosition == 'RP'}">Relief Pitcher (RP)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="minContract">Min Contract Length:</label>
                        <input type="number" id="minContract" name="minContract" th:value="${minContract}" placeholder="Years">
                    </div>
                    
                    <div class="filter-group">
                        <label for="maxContract">Max Contract Length:</label>
                        <input type="number" id="maxContract" name="maxContract" th:value="${maxContract}" placeholder="Years">
                    </div>
                </div>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="minSalary">Min Salary:</label>
                        <input type="number" step="0.01" id="minSalary" name="minSalary" th:value="${minSalary}" placeholder="$">
                    </div>
                    
                    <div class="filter-group">
                        <label for="maxSalary">Max Salary:</label>
                        <input type="number" step="0.01" id="maxSalary" name="maxSalary" th:value="${maxSalary}" placeholder="$">
                    </div>
                    
                    <div class="filter-group">
                        <button type="submit">Apply Filters</button>
                        <a th:href="@{/team}" style="margin-top: 5px;">Clear Filters</a>
                    </div>
                </div>
            </form>
        </div>

        <!-- Players Table -->
        <table class="players-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Position</th>
                    <th>MLB Team</th>
                    <th>Contract Length</th>
                    <th>Contract Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="player : ${players}">
                    <td th:text="${player.name}">Player Name</td>
                    <td th:text="${player.position}">Position</td>
                    <td th:text="${player.team}">MLB Team</td>
                    <td th:text="${player.contractLength != null ? player.contractLength + ' years' : 'Free Agent'}">Contract Length</td>
                    <td th:text="${player.contractAmount != null ? '$' + #numbers.formatDecimal(player.contractAmount, 0, 2) : 'No Contract'}">Contract Amount</td>
                </tr>
                <tr th:if="${#lists.isEmpty(players)}">
                    <td colspan="5" style="text-align: center; font-style: italic;">No players found with the current filters.</td>
                </tr>
            </tbody>
        </table>

        <!-- Add Player Form -->
        <div class="add-player-form">
            <h3>Add New Player</h3>
            <form th:action="@{/team/add-player}" method="post">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Player Name:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="playerPosition">Position:</label>
                        <select id="playerPosition" name="position" required>
                            <option value="C">Catcher (C)</option>
                            <option value="1B">First Base (1B)</option>
                            <option value="2B">Second Base (2B)</option>
                            <option value="3B">Third Base (3B)</option>
                            <option value="SS">Shortstop (SS)</option>
                            <option value="OF">Outfield (OF)</option>
                            <option value="DH">Designated Hitter (DH)</option>
                            <option value="SP">Starting Pitcher (SP)</option>
                            <option value="RP">Relief Pitcher (RP)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="playerTeam">MLB Team:</label>
                        <select id="playerTeam" name="team" required>
                            <option value="">Select a team</option>
                            <option value="Arizona Diamondbacks">Arizona Diamondbacks</option>
                            <option value="Atlanta Braves">Atlanta Braves</option>
                            <option value="Baltimore Orioles">Baltimore Orioles</option>
                            <option value="Boston Red Sox">Boston Red Sox</option>
                            <option value="Chicago Cubs">Chicago Cubs</option>
                            <option value="Chicago White Sox">Chicago White Sox</option>
                            <option value="Cincinnati Reds">Cincinnati Reds</option>
                            <option value="Cleveland Guardians">Cleveland Guardians</option>
                            <option value="Colorado Rockies">Colorado Rockies</option>
                            <option value="Detroit Tigers">Detroit Tigers</option>
                            <option value="Houston Astros">Houston Astros</option>
                            <option value="Kansas City Royals">Kansas City Royals</option>
                            <option value="Los Angeles Angels">Los Angeles Angels</option>
                            <option value="Los Angeles Dodgers">Los Angeles Dodgers</option>
                            <option value="Miami Marlins">Miami Marlins</option>
                            <option value="Milwaukee Brewers">Milwaukee Brewers</option>
                            <option value="Minnesota Twins">Minnesota Twins</option>
                            <option value="New York Mets">New York Mets</option>
                            <option value="New York Yankees">New York Yankees</option>
                            <option value="Oakland Athletics">Oakland Athletics</option>
                            <option value="Philadelphia Phillies">Philadelphia Phillies</option>
                            <option value="Pittsburgh Pirates">Pittsburgh Pirates</option>
                            <option value="San Diego Padres">San Diego Padres</option>
                            <option value="San Francisco Giants">San Francisco Giants</option>
                            <option value="Seattle Mariners">Seattle Mariners</option>
                            <option value="St. Louis Cardinals">St. Louis Cardinals</option>
                            <option value="Tampa Bay Rays">Tampa Bay Rays</option>
                            <option value="Texas Rangers">Texas Rangers</option>
                            <option value="Toronto Blue Jays">Toronto Blue Jays</option>
                            <option value="Washington Nationals">Washington Nationals</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="contractLength">Contract Length (Years):</label>
                        <input type="number" id="contractLength" name="contractLength" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="contractAmount">Contract Amount ($):</label>
                        <select id="contractAmount" name="contractAmount" required>
                            <option value="">Select contract amount</option>
                            <option value="250000">$250,000</option>
                            <option value="500000">$500,000</option>
                            <option value="750000">$750,000</option>
                            <option value="1000000">$1,000,000</option>
                            <option value="2000000">$2,000,000</option>
                            <option value="3000000">$3,000,000</option>
                            <option value="4000000">$4,000,000</option>
                            <option value="5000000">$5,000,000</option>
                            <option value="6000000">$6,000,000</option>
                            <option value="7000000">$7,000,000</option>
                            <option value="8000000">$8,000,000</option>
                            <option value="9000000">$9,000,000</option>
                            <option value="10000000">$10,000,000</option>
                            <option value="11000000">$11,000,000</option>
                            <option value="12000000">$12,000,000</option>
                            <option value="13000000">$13,000,000</option>
                            <option value="14000000">$14,000,000</option>
                            <option value="15000000">$15,000,000</option>
                            <option value="16000000">$16,000,000</option>
                            <option value="17000000">$17,000,000</option>
                            <option value="18000000">$18,000,000</option>
                            <option value="19000000">$19,000,000</option>
                            <option value="20000000">$20,000,000</option>
                            <option value="25000000">$25,000,000</option>
                            <option value="30000000">$30,000,000</option>
                            <option value="35000000">$35,000,000</option>
                            <option value="40000000">$40,000,000</option>
                            <option value="45000000">$45,000,000</option>
                            <option value="50000000">$50,000,000</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" style="margin-top: 20px;">Add Player</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Bulk Import Players Form -->
        <div class="bulk-import-form">
            <h3>Bulk Import Players from Excel</h3>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                Upload an Excel file (.xlsx or .xls) with player data. The file should have the following columns in order:<br>
                <strong>Name | Position | MLB Team | Contract Length (years) | Contract Amount ($)</strong><br>
                <em>Note: Contract Length and Contract Amount can be left blank for free agents.</em><br>
                <a th:href="@{/team/download-template}" style="color: #007bff; text-decoration: none; font-weight: bold;">
                    üìÑ Download Sample Template
                </a>
            </p>
            
            <!-- Success/Error Messages -->
            <div th:if="${success}" class="alert alert-success" style="background-color: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                <span th:text="${success}"></span>
            </div>
            <div th:if="${error}" class="alert alert-error" style="background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                <span th:text="${error}"></span>
            </div>
            
            <form th:action="@{/team/bulk-import}" method="post" enctype="multipart/form-data" onsubmit="return validateFile()">
                <div class="form-row">
                    <div class="form-group">
                        <label id="file-label" for="file">Select Excel File:</label>
                        <input type="file" id="file" name="file" accept=".xlsx,.xls" required 
                               onchange="updateFileName()"
                               style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="display: block; color: #666; margin-top: 5px;">
                            Maximum file size: 10MB. Supported formats: .xlsx, .xls
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" id="import-button" 
                                style="margin-top: 20px; background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">
                            Import Players
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- Sample Excel Template -->
            <div style="margin-top: 20px;">
                <h4>Sample Excel Format:</h4>
                <table style="border-collapse: collapse; margin-top: 10px; font-size: 0.9em;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="border: 1px solid #ddd; padding: 8px;">Name</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Position</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">MLB Team</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Contract Length</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Contract Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">Mike Trout</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">OF</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">Los Angeles Angels</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">10</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">35000000</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">John Doe</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">C</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">Boston Red Sox</td>
                            <td style="border: 1px solid #ddd; padding: 8px;"></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"></td>
                        </tr>
                    </tbody>
                </table>
                <p style="font-size: 0.85em; color: #666; margin-top: 10px;">
                    <strong>Valid Positions:</strong> C, 1B, 2B, 3B, SS, OF, DH, SP, RP<br>
                    <strong>Contract Amount:</strong> Enter as a number (e.g., 1000000 for $1M) or with dollar signs/commas (e.g., $1,000,000)
                </p>
            </div>
        </div>
    </div>
</body>
</html>